<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <script type="text/javascript">
            function doit(tit){                
                
                document.getElementById("divMain").setAttribute("style", "left: 131.5px; z-index: 1015; display: block; top: 80px;");
                var frame = document.getElementById("myFrame");
                frame.src = "faces/usuario/resumen.xhtml?doc="+tit;
                frame.setAttribute("style", "width:1000px; height: 100%; border:0 none; display: block; margin: 0 auto; margin-top: 50px;");               
                
                document.getElementById("modal").setAttribute("style", "position: fixed; left: 0; top: 0; overflow: hidden; margin: 0; padding: 0; width: 100%; height: 100%; z-index: 1014;"); 
            }
            function hideLight(){
                var divMain = document.getElementById("divMain");
                var frame2 = document.getElementById("myFrame");
                frame2.setAttribute("src", "about:blank");
                divMain.setAttribute("style", "visibility: hidden; ");
                document.getElementById("modal").setAttribute("style", "visibility: hidden;");
            }
            function resizeFrame(f) {
                var s;
                s = 100;
                f.style.height = s;
                s = f.contentWindow.document.body.scrollHeight + "px";
                f.style.height = s;
            }
        </script>
    </h:head>
    <h:body>
        <h:form id="form_busqueda" style="margin-top: 0px; margin-bottom: 0px;">
            <p:messages id="msgs"/>
            <p:scrollPanel mode="native" style="height: 430px; border: 0px;">
                <p:panel header="Opciones de Búsqueda" style="background: none; ">
                    <p:outputLabel for="filtros" value="Frases clave: " style="font-size: 10pt; font-weight: bold;"/>
                    <p:autoComplete maxResults="15" id="filtros" value="#{tbusquedaBean.filtros}" completeMethod="#{autoComplete.complete}"
                                    minQueryLength="3" size="500" multiple="true" queryDelay="50"/>
                    <p:commandButton value="Buscar" actionListener="#{tbusquedaBean.Filtrar()}" 
                                     update=":tabView:form_busqueda:papers" />
                    <p:commandButton value="Limpiar" action="#{tbusquedaBean.Limpiar()}" 
                                     update=":tabView:form_busqueda:filtros, :tabView:form_busqueda:papers"/>
                </p:panel>
                <br/>
                <p:dataGrid value="#{tbusquedaBean.filteredPapers}" var="paper" id="papers"  
                            paginator="true" rows="5" columns="1" 
                            paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink} {RowsPerPageDropdown}"  
                            rowsPerPageTemplate="5,10,15,20" paginatorPosition="bottom"
                            emptyMessage="No hay artículos">  

                    <f:facet name="header">  
                        Artículos 
                    </f:facet>
                    <p:column>
                        <p:panel style="background: none; border: 0px;">
                            <p:commandLink onclick="doit('#{paper.idPaper}');" style="text-decoration: none;">
                                <table cellspacing="0" cellpadding="0">
                                    <tr>
                                        <td>
                                            <span class="ui-button-icon-left ui-icon ui-icon-search"/>  
                                        </td>
                                        <td>
                                            <h:outputText id="ptitulo" value="#{paper.titulo}." style="font-size: 10pt;"/>
                                        </td>
                                    </tr>
                                </table>
                                                                                  
                                
                            </p:commandLink>                             
                            <p:tooltip for="ptitulo" style="margin-right: auto;" >
                                <h3>Autores</h3>
                                <p:dataList value="#{paper.autores}" var="autor" itemType="square" style="background: none; border: 0px;">
                                    #{autor}. &nbsp; &nbsp; &nbsp;
                                </p:dataList>
                            </p:tooltip>
                        </p:panel>                    
                    </p:column>
                </p:dataGrid>
            </p:scrollPanel>
        </h:form>
        <div id="divMain" class="ui-lightbox ui-widget ui-helper-hidden ui-hidden-container" style="z-index: 1015; display: none;">
            <div class="ui-lightbox-content-wrapper" style="margin-bottom: 0;">
                <a class="ui-state-default ui-lightbox-nav-left ui-corner-right ui-helper-hidden" style="padding: 10px;">
                    <span class="ui-icon ui-icon-carat-1-e"></span>
                </a>
                <div class="ui-lightbox-content ui-corner-all" id="container">
                    <iframe id="myFrame" scrolling="no" frameborder="0" style="border:0 none; margin: 0 auto;" onload="resizeFrame(this)">

                    </iframe>
                </div>
                <a class="ui-state-default ui-lightbox-nav-right ui-corner-left ui-helper-hidden"></a>
            </div>
            <div class="ui-lightbox-caption ui-widget-header ui-helper-hidden"></div>
        </div>
        <div class="ui-widget-overlay" id="modal" style="visibility: hidden; position: fixed; overflow: hidden; margin: 0; padding: 0; " onclick="hideLight()"></div>
    </h:body>
</html>

